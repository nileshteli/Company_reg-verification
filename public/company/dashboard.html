<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Dashboard - Advanced</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; }
        .header { background: #2c3e50; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; }
        
        .sidebar { position: fixed; left: 0; top: 70px; width: 250px; height: calc(100vh - 70px); background: white; border-right: 1px solid #ddd; overflow-y: auto; }
        .sidebar a { display: block; padding: 12px 20px; text-decoration: none; color: #555; border-bottom: 1px solid #f0f0f0; transition: 0.3s; }
        .sidebar a:hover, .sidebar a.active { background: #3498db; color: white; }
        
        .main-content { margin-left: 250px; padding: 2rem; margin-top: 70px; }
        
        .card { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 1.5rem; }
        .section { display: none; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 2rem; }
        .stat-card { padding: 2rem; border-radius: 8px; text-align: center; color: white; background: #5d69be; }
        .stat-card.purple { background: #8e44ad; }
        .stat-card.blue { background: #3498db; }
        .stat-number { font-size: 2.5rem; font-weight: bold; }

        .btn { padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; margin-right: 5px; margin-top: 5px; }
        .btn-primary { background: #3498db; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-warning { background: #f39c12; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; }
        
        .table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .table th, .table td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 1.5rem; font-weight: bold;">Company Dashboard</div>
        <div>
            <span id="displayCompName">Welcome, Company!</span>
            <button class="btn btn-danger" onclick="logout()" style="margin-left: 20px;">Logout</button>
        </div>
    </div>

    <div class="sidebar">
        <a href="#" class="active" onclick="showSection('overview')">ğŸ“Š Overview</a>
        <a href="#" onclick="showSection('profile')">ğŸ¢ Company Profile</a>
        <a href="#" onclick="showSection('postjob')">ğŸ’¼ Post Job</a>
        <a href="#" onclick="showSection('myjobs')">ğŸ“‹ My Jobs</a>
        <a href="#" onclick="showSection('applications')">ğŸ‘¥ Applications</a>
        <a href="#" onclick="showSection('stats')">ğŸ“ˆ Job Statistics</a>
        <a href="#" onclick="showSection('employees')">ğŸ‘¨â€ğŸ’¼ Employees</a>
        <a href="#" onclick="showSection('finances')">ğŸ’° Finances</a>
        <a href="#" onclick="showSection('settings')">âš™ï¸ Settings</a>
    </div>

    <div class="main-content">
        
        <div id="overview" class="section" style="display: block;">
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-number" id="totalPosted">0</div><div>Total Jobs Posted</div></div>
                <div class="stat-card purple"><div class="stat-number" id="activeJobs">0</div><div>Active Jobs</div></div>
                <div class="stat-card blue"><div class="stat-number" id="totalApplicants">0</div><div>Applications</div></div>
                <div class="stat-card purple"><div class="stat-number">100%</div><div>Profile Complete</div></div>
            </div>
            
            <div class="card">
                <h3>Quick Actions</h3>
                <button class="btn btn-success" onclick="showSection('postjob')">Post New Job</button>
                <button class="btn btn-primary" onclick="showSection('myjobs')">Manage Listings</button>
                <button class="btn btn-warning" onclick="showSection('applications')">Review Applicants</button>
            </div>
        </div>

        <div id="postjob" class="section">
            <div class="card">
                <h3>ğŸ“ Post New Job</h3>
                <form id="jobForm">
                    <input type="text" id="jTitle" placeholder="Job Title" required>
                    <select id="jType">
                        <option value="fulltime">Full Time</option>
                        <option value="internship">Internship</option>
                    </select>
                    <input type="text" id="jLoc" placeholder="Location">
                    <input type="text" id="jSal" placeholder="Salary">
                    <textarea id="jDesc" placeholder="Job Description"></textarea>
                    <button type="submit" class="btn btn-success">Post Now</button>
                </form>
            </div>
        </div>

        <div id="myjobs" class="section">
            <div class="card">
                <h3>ğŸ“‹ My Posted Jobs</h3>
                <div id="jobsContainer"></div>
            </div>
        </div>

        <div id="applications" class="section">
            <div class="card">
                <h3>ğŸ‘¥ Incoming Applications</h3>
                <div id="appsContainer"></div>
            </div>
        </div>

        <div id="profile" class="section"><div class="card"><h3>ğŸ¢ Company Profile</h3><p>Manage your company details here.</p></div></div>
        <div id="stats" class="section"><div class="card"><h3>ğŸ“ˆ Job Statistics</h3><p>Data insights coming soon.</p></div></div>
        <div id="employees" class="section"><div class="card"><h3>ğŸ‘¨â€ğŸ’¼ Employee Management</h3><p>Staff records coming soon.</p></div></div>
        <div id="finances" class="section"><div class="card"><h3>ğŸ’° Finances</h3><p>Revenue and payment tracking.</p></div></div>
        <div id="settings" class="section"><div class="card"><h3>âš™ï¸ Settings</h3><p>Configure your account preferences.</p></div></div>

    </div>

    <script>
        const user = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const email = user.email || 'company@test.com';
        document.getElementById('displayCompName').innerText = `Welcome, ${user.name || 'Company'}!`;

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
            
            if(id === 'myjobs') renderMyJobs();
            if(id === 'applications') renderApps();
            updateDashboardStats();
        }

        // Job Posting
        document.getElementById('jobForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const job = {
                id: Date.now(),
                title: document.getElementById('jTitle').value,
                type: document.getElementById('jType').value,
                location: document.getElementById('jLoc').value,
                salary: document.getElementById('jSal').value,
                description: document.getElementById('jDesc').value,
                company: user.name || "Test Company",
                companyEmail: email
            };
            const allJobs = JSON.parse(localStorage.getItem('allJobs') || '[]');
            allJobs.push(job);
            localStorage.setItem('allJobs', JSON.stringify(allJobs));
            alert('Job Posted!');
            e.target.reset();
            showSection('myjobs');
        });

        // Render My Jobs
        function renderMyJobs() {
            const allJobs = JSON.parse(localStorage.getItem('allJobs') || '[]');
            const myJobs = allJobs.filter(j => j.companyEmail === email);
            const container = document.getElementById('jobsContainer');
            container.innerHTML = myJobs.map(j => `
                <div class="card" style="border: 1px solid #ddd; margin-bottom: 10px;">
                    <h4>${j.title}</h4>
                    <p>${j.location} | ${j.salary}</p>
                    <button class="btn btn-danger" onclick="deleteJob(${j.id})">Delete</button>
                </div>
            `).join('') || "No jobs found.";
        }

        function deleteJob(id) {
            if(!confirm('Delete this job?')) return;
            let allJobs = JSON.parse(localStorage.getItem('allJobs') || '[]');
            allJobs = allJobs.filter(j => j.id !== id);
            localStorage.setItem('allJobs', JSON.stringify(allJobs));
            renderMyJobs();
            updateDashboardStats();
        }

        // --- RESTORED APPLICATIONS LOGIC ---
        function renderApps() {
            const allApps = JSON.parse(localStorage.getItem('globalApplications') || '[]');
            const myApps = allApps.filter(a => a.companyEmail === email);
            const container = document.getElementById('appsContainer');

            if(myApps.length === 0) {
                container.innerHTML = "<p>No applications received yet.</p>";
                return;
            }

            container.innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Job Title</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${myApps.map(a => `
                            <tr>
                                <td><strong>${a.studentName}</strong><br><small>${a.studentEmail}</small></td>
                                <td>${a.jobTitle}</td>
                                <td><span class="status-badge status-${a.status.toLowerCase()}">${a.status}</span></td>
                                <td>
                                    <button class="btn btn-success" onclick="updateAppStatus(${a.id}, 'Approved')">Approve</button>
                                    <button class="btn btn-danger" onclick="updateAppStatus(${a.id}, 'Rejected')">Reject</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function updateAppStatus(appId, newStatus) {
            let allApps = JSON.parse(localStorage.getItem('globalApplications') || '[]');
            allApps = allApps.map(app => {
                if(app.id === appId) app.status = newStatus;
                return app;
            });
            localStorage.setItem('globalApplications', JSON.stringify(allApps));
            alert(`Application ${newStatus}!`);
            renderApps();
            updateDashboardStats();
        }

        function updateDashboardStats() {
            const allJobs = JSON.parse(localStorage.getItem('allJobs') || '[]');
            const myJobs = allJobs.filter(j => j.companyEmail === email);
            const allApps = JSON.parse(localStorage.getItem('globalApplications') || '[]');
            const myApps = allApps.filter(a => a.companyEmail === email);
            
            document.getElementById('totalPosted').innerText = myJobs.length;
            document.getElementById('activeJobs').innerText = myJobs.length;
            document.getElementById('totalApplicants').innerText = myApps.length;
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = '../index.html';
        }

        updateDashboardStats();
    </script>
</body>
</html>