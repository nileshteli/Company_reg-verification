<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Verification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 400px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 30px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; text-align: center; font-size: 20px; letter-spacing: 10px; }
        button { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background: #218838; }
        .info { text-align: center; color: #666; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Verify OTP</h2>
        <p class="info">Enter the 6-digit code sent to your email</p>
        <form id="otpForm">
            <input type="text" id="otp" placeholder="000000" maxlength="6" required>
            <button type="submit">Verify OTP</button>
        </form>
    </div>
    <script>
        document.getElementById('otpForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const enteredOtp = document.getElementById('otp').value;
            
            // Get user data and stored OTP
            const userData = JSON.parse(localStorage.getItem('companyData') || '{}');
            const storedOtp = localStorage.getItem('generatedOtp');
            const otpExpiry = localStorage.getItem('otpExpiry');
            
            // Check if OTP is expired (5 minutes)
            if(Date.now() > parseInt(otpExpiry)) {
                alert('OTP has expired. Please request a new one.');
                return;
            }
            
            // Verify OTP
            if(enteredOtp === storedOtp) {
                if(userData.userType === 'student') {
                    // Save student as registered
                    let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    registeredUsers.push({
                        email: userData.email,
                        password: userData.password,
                        userType: 'student',
                        name: userData.name,
                        phone: userData.phone,
                        university: userData.university,
                        degree: userData.degree,
                        graduationYear: userData.graduationYear,
                        registeredDate: new Date().toISOString()
                    });
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    
                    // Clear OTP data
                    localStorage.removeItem('generatedOtp');
                    localStorage.removeItem('otpExpiry');
                    
                    alert('Account verified successfully!');
                    window.location.href = '../job-portal.html';
                } else {
                    // Save company as registered
                    let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    registeredUsers.push({
                        email: userData.email,
                        password: userData.password,
                        userType: 'company',
                        name: userData.name,
                        phone: userData.phone,
                        registeredDate: new Date().toISOString()
                    });
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    
                    // Clear OTP data
                    localStorage.removeItem('generatedOtp');
                    localStorage.removeItem('otpExpiry');
                    
                    alert('Account verified successfully!');
                    window.location.href = 'company_info.html';
                }
            } else {
                alert('Invalid OTP. Please check your email and try again.');
            }
        });

        // Generate and "send" OTP when page loads
        window.addEventListener('load', function() {
            const userData = JSON.parse(localStorage.getItem('companyData') || '{}');
            const otp = Math.floor(100000 + Math.random() * 900000).toString(); // 6-digit OTP
            const expiry = Date.now() + (5 * 60 * 1000); // 5 minutes from now
            
            // Store OTP and expiry
            localStorage.setItem('generatedOtp', otp);
            localStorage.setItem('otpExpiry', expiry.toString());
            
            // Simulate email sending
            console.log(`OTP sent to ${userData.email}: ${otp}`);
            alert(`OTP sent to ${userData.email}\n\nFor demo purposes, your OTP is: ${otp}\n\n(In production, this would be sent via email)`);
        });

        function resendOtp() {
            const userData = JSON.parse(localStorage.getItem('companyData') || '{}');
            const otp = Math.floor(100000 + Math.random() * 900000).toString();
            const expiry = Date.now() + (5 * 60 * 1000);
            
            localStorage.setItem('generatedOtp', otp);
            localStorage.setItem('otpExpiry', expiry.toString());
            
            console.log(`New OTP sent to ${userData.email}: ${otp}`);
            alert(`New OTP sent to ${userData.email}\n\nFor demo purposes, your OTP is: ${otp}`);
        }
    </script>
</body>
</html>
